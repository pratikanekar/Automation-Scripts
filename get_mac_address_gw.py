from fabric import Connection
from time import sleep
import pandas as pd

hostlist = [
    '192.168.75.13',
    '192.168.105.14',
    '192.168.61.13',
    '192.168.103.14',
    '192.168.79.13',
    '192.168.109.14',
    '192.168.112.13',
    '192.168.67.13',
    '192.168.106.13',
    '192.168.105.13',
    '192.168.108.13',
    '192.168.94.13',
    '192.168.109.13',
    '192.168.101.13',
    '192.168.59.13',
    '192.168.71.13',
    '192.168.104.13',
    '192.168.102.13',
    '192.168.77.13',
    '192.168.103.13',
    '192.168.91.13',
    '192.168.95.13',
    '192.168.64.13',
    '192.168.98.13',
    '192.168.60.13',
    '192.168.62.13',
    '192.168.84.13',
    '192.168.63.13',
    '192.168.85.13',
    '192.168.76.13',
    '192.168.113.13',
    '192.168.68.13',
    '192.168.74.13',
    '192.168.65.13',
    '192.168.72.13',
    '192.168.81.14',
    '192.168.81.16',
    '192.168.80.15',
    '192.168.80.16',
    '192.168.59.15',
    '192.168.90.13',
    '192.168.74.14',
    '192.168.86.13',
    '192.168.58.13',
    '192.168.58.14',
    '192.168.81.15',
    '192.168.55.13',
    '192.168.55.14',
    '192.168.57.13',
    '192.168.56.13',
    '192.168.55.15',
    '192.168.56.14',
    '192.168.58.15',
    '192.168.58.16',
    '192.168.59.14',
    '192.168.60.14',
    '192.168.60.15',
    '192.168.61.14',
    '192.168.61.15',
    '192.168.61.16',
    '192.168.64.14',
    '192.168.64.15',
    '192.168.66.13',
    '192.168.66.14',
    '192.168.66.15',
    '192.168.67.14',
    '192.168.67.15',
    '192.168.68.14',
    '192.168.68.16',
    '192.168.69.13',
    '192.168.70.13',
    '192.168.70.14',
    '192.168.70.15',
    '192.168.70.16',
    '192.168.71.14',
    '192.168.71.15',
    '192.168.73.13',
    '192.168.73.14',
    '192.168.73.15',
    '192.168.74.15',
    '192.168.74.16',
    '192.168.75.14',
    '192.168.75.15',
    '192.168.75.16',
    '192.168.75.17',
    '192.168.75.18',
    '192.168.76.14',
    '192.168.76.15',
    '192.168.76.16',
    '192.168.76.17',
    '192.168.78.13',
    '192.168.80.13',
    '192.168.80.14',
    '192.168.81.13',
    '192.168.82.13',
    '192.168.82.14',
    '192.168.82.15',
    '192.168.85.14',
    '192.168.85.15',
    '192.168.85.16',
    '192.168.87.13',
    '192.168.87.14',
    '192.168.87.15',
    '192.168.88.13',
    '192.168.88.14',
    '192.168.88.15',
    '192.168.90.14',
    '192.168.90.15',
    '192.168.90.16',
    '192.168.91.14',
    '192.168.91.15',
    '192.168.93.13',
    '192.168.93.14',
    '192.168.94.14',
    '192.168.94.16',
    '192.168.98.14',
    '192.168.101.14',
    '192.168.101.15',
    '192.168.101.16',
    '192.168.103.15',
    '192.168.104.14',
    '192.168.104.15',
    '192.168.104.16',
    '192.168.105.15',
    '192.168.105.16',
    '192.168.106.14',
    '192.168.106.15',
    '192.168.106.16',
    '192.168.109.15',
    '192.168.108.14',
    '192.168.108.15'
]
username = 'pi'
password = 'iamgw_#@!'

data = {'IP Address': [], 'MAC Address': []}

try:
    for hostname in hostlist:
        try:
            with Connection(
                    host=hostname,
                    user=username,
                    connect_kwargs={"password": password},
                    connect_timeout=2  # Set connection timeout to 2 seconds
            ) as c:
                result = c.sudo("ifconfig eth0", warn=True, hide=True)
                if result.failed:
                    ether_address = "None"
                else:
                    ether_address = result.stdout.split("ether ")[1].split(" ")[0]

                print(f"Ether address of eth0 on {hostname}: {ether_address}")

                data['IP Address'].append(hostname)
                data['MAC Address'].append(ether_address)

        except Exception as e:
            print(f"Error connecting to {hostname}: {e}")
            data['IP Address'].append(hostname)
            data['MAC Address'].append("None")

        sleep(0.5)

except Exception as e:
    print(f"Error: {e}")

# Create a DataFrame from the collected data
df = pd.DataFrame(data)

# Save the DataFrame to an Excel file
df.to_excel('download/get_mac_output.xlsx', index=False)

print("Data saved to output.xlsx")
